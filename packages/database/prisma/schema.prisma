datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  // shadowDatabaseUrl = env("SHADOW_DATABASE_URL")
  // directUrl = env("DIRECT_DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model Account {
  address String @id
  name    String
  surname String
}

model Course {
  address                      String
  name                         String            @default("")
  description                  String            @default("")
  symbol                       String            @default("")
  image_url                    String            @default("")
  website_url                  String            @default("")
  media_channel                String            @default("")
  ipfs_metadata                String            @default("")
  timestamp                    Int
  chain_id                     Int
  karma_access_control_address String
  snapshot_space_ens           String            @default("")
  user_credentials             UserCredentials[]
  credentials                  Credential[]

  @@id([address, chain_id])
}

enum CredentialType {
  ADMIN
  DISCIPULUS
  MAGISTER
  OTHER
}

model Credential {
  id               Int               @id @default(autoincrement())
  name             String
  description      String
  image_url        String
  ipfs_url         String
  ipfs_cid         String
  type             CredentialType
  user_credentials UserCredentials[]
  course           Course            @relation(fields: [course_address, course_chain_id], references: [address, chain_id])
  course_address   String
  course_chain_id  Int

  @@unique([ipfs_cid])
}

model UserCredentials {
  course         Course     @relation(fields: [course_address, chain_id], references: [address, chain_id])
  course_address String
  chain_id       Int
  user_address   String
  credential     Credential @relation(fields: [credential_id], references: [id])
  credential_id  Int
  email          String     @default("")
  discord_handle String     @default("")

  @@id([course_address, user_address, credential_id])
}
