datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  // shadowDatabaseUrl = env("SHADOW_DATABASE_URL")
  // directUrl = env("DIRECT_DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model Account {
  address String @id
  name    String
  surname String
}

model Course {
  id                           Int                 @id @default(autoincrement())
  address                      String
  name                         String              @default("")
  description                  String              @default("")
  symbol                       String              @default("")
  image_url                    String              @default("")
  website_url                  String              @default("")
  media_channel                String              @default("")
  ipfs_metadata                String              @default("")
  timestamp                    Int
  chain_id                     Int
  karma_access_control_address String
  snapshot_space_ens           String              @default("")
  credentials                  Credential[]
  credentials_assignment       CourseCredentials[]

  @@unique([address, chain_id])
}

enum CredentialType {
  ADMIN
  DISCIPULUS
  MAGISTER
  OTHER
}

model Credential {
  name               String
  description        String
  image_url          String
  ipfs_url           String
  ipfs_cid           String
  type               CredentialType
  course_credentials CourseCredentials[]
  course             Course[]

  @@id([ipfs_cid])
}

model CourseCredentials {
  course              Course     @relation(fields: [course_address, chain_id], references: [address, chain_id])
  course_address      String
  chain_id            Int
  user_address        String
  credential          Credential @relation(fields: [credential_ipfs_cid], references: [ipfs_cid])
  credential_ipfs_cid String
  email               String     @default("")
  discord_handle      String     @default("")

  @@id([course_address, user_address, credential_ipfs_cid])
}
